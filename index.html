<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Textbook AI Chat</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<style>
  body {
    font-family: 'Roboto', sans-serif;
    margin: 0; padding: 0;
    height: 100vh;
    display: flex;
    flex-direction: column;
    background: #f5f5f7;
  }

  header {
    background: #0d6efd;
    color: #fff;
    padding: 15px 20px;
    text-align: center;
    font-size: 1.5rem;
    font-weight: 500;
  }

  #chatContainer {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 15px;
  }

  .message {
    max-width: 70%;
    padding: 12px 16px;
    border-radius: 15px;
    line-height: 1.5;
    word-wrap: break-word;
  }

  .user {
    align-self: flex-end;
    background: #0d6efd;
    color: white;
    border-bottom-right-radius: 0;
  }

  .ai {
    align-self: flex-start;
    background: #e2e3e5;
    color: #1f2937;
    border-bottom-left-radius: 0;
  }

#inputBox {
  display: flex;
  justify-content: center;
  align-items: center;
  justify-items: center;
  padding: 10px;
  gap: 10px; /* space between input and button */
  background: #f5f5f7;
  flex-wrap: wrap; /* allow wrapping on very small screens */
}

#questionInput {
  flex: 1 1 auto;           /* flexible width but grows/shrinks */
  min-width: 150px;          /* don't shrink too small */
  max-width: 500px;          /* cap maximum width */
  padding: 12px 15px;
  border: 1px solid #ccc;
  border-radius: 25px;
  font-size: 1rem;
}

button {
  flex: 0 0 auto;            /* fixed size button */
  padding: 12px 20px;
  background: #0d6efd;
  color: #fff;
  border: none;
  border-radius: 25px;
  font-size: 1rem;
  cursor: pointer;
  transition: background 0.2s;
}




  button:hover {
    background: #0b5ed7;
  }

  @media(max-width: 600px){
    .message {
      max-width: 90%;
    }
    button {
      padding: 10px 15px;
    }
  }
</style>
</head>
<body>

<div id="chatContainer"></div>

<div id="inputBox">
  <input type="text" id="questionInput" placeholder="Type your question...">
  <button onclick="sendQuestion()">Send</button>
</div>

<script>
  const chatContainer = document.getElementById("chatContainer");
  const questionInput = document.getElementById("questionInput");

  function addMessage(text, sender){
    const msg = document.createElement("div");
    msg.className = "message " + sender;
    msg.innerText = text;
    chatContainer.appendChild(msg);
    chatContainer.scrollTop = chatContainer.scrollHeight;
  }

  async function sendQuestion(){
    const question = questionInput.value.trim();
    if(!question) return;

    // Add user message
    addMessage(question, "user");
    questionInput.value = "";

    // Add temporary AI loading message
    const loadingMsg = document.createElement("div");
    loadingMsg.className = "message ai";
    loadingMsg.innerText = "AI is typing...";
    chatContainer.appendChild(loadingMsg);
    chatContainer.scrollTop = chatContainer.scrollHeight;

    try {
      // Call Node.js backend
      const response = await fetch("http://localhost:3000/ask", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ question })
      });

      const data = await response.json();
      loadingMsg.innerText = data.answer || "Not in textbook.";
    } catch(err){
      console.error(err);
      loadingMsg.innerText = "Error: Could not get answer.";
    }
  }

  questionInput.addEventListener("keypress", function(e){
    if(e.key === "Enter") sendQuestion();
  });
</script>

</body>
</html>
